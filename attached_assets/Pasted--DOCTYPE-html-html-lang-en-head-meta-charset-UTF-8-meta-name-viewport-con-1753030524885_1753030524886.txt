<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Pinball All Stars</title>
    
    <!-- –ü—Ä–∞–≤–∏–ª—å–Ω—ã–µ meta-—Ç–µ–≥–∏ –¥–ª—è Mini App -->
    <meta property="fc:miniapp" content='{
      "version":"1",
      "imageUrl":"https://your-domain.com/preview-image.png",
      "button":{
        "title":"üéÆ Play Pinball",
        "action":{
          "type":"launch_miniapp",
          "name":"Pinball All Stars",
          "url":"https://your-domain.com/?miniApp=true",
          "splashImageUrl":"https://your-domain.com/splash-icon.png",
          "splashBackgroundColor":"#1a1a2e"
        }
      }
    }' />
    
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <!-- –í–∞—à —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π HTML... -->
    
    <!-- –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ Mini App –æ–∫—Ä—É–∂–µ–Ω–∏—è -->
    <script>
        window.isMiniApp = window.parent !== window || 
                          window.location.search.includes('miniApp=true') ||
                          navigator.userAgent.includes('Warpcast') ||
                          navigator.userAgent.includes('Farcaster');
        
        console.log('Mini App environment detected:', window.isMiniApp);
    </script>

    <!-- –ö–†–ò–¢–ò–ß–ù–û: –ë—ã—Å—Ç—Ä–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è SDK –∏ ready() -->
    <script type="module">
        if (window.isMiniApp) {
            try {
                console.log('üì¶ Loading Farcaster SDK...');
                
                // ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–´–ô SDK
                const { sdk } = await import('https://esm.sh/@farcaster/miniapp-sdk');
                window.sdk = sdk;
                console.log('‚úÖ Farcaster SDK loaded successfully');
                
                // ‚úÖ –ö–†–ò–¢–ò–ß–ù–û: –í—ã–∑—ã–≤–∞–µ–º ready() –ù–ï–ú–ï–î–õ–ï–ù–ù–û!
                await sdk.actions.ready({
                    disableNativeGestures: false
                });
                console.log('üéâ Splash screen dismissed IMMEDIATELY');
                
                // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤ –∏–≥—Ä–µ
                try {
                    window.farcasterContext = await sdk.context;
                    console.log('üìã Context received:', window.farcasterContext);
                } catch (error) {
                    console.log('‚ö†Ô∏è Could not get context:', error);
                }
                
                // ‚úÖ –ü–æ–º–µ—á–∞–µ–º —á—Ç–æ SDK –≥–æ—Ç–æ–≤
                window.farcasterSDKReady = true;
                
            } catch (error) {
                console.error('‚ùå Failed to load Farcaster SDK:', error);
            }
        } else {
            console.log('‚è≠Ô∏è Not in Mini App environment');
            window.farcasterSDKReady = false;
        }
    </script>
    
    <!-- –ó–∞–≥—Ä—É–∂–∞–µ–º –≤–∞—à–∏ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Å–∫—Ä–∏–ø—Ç—ã -->
    <script src="core/SoundManager.js"></script>
    <script src="core/GameConfig.js"></script>
    <script src="core/Vector2D.js"></script>
    <script src="core/utils.js"></script>
    <script src="core/GameState.js"></script>
    
    <!-- –§–∏–∑–∏–∫–∞ –∏ –∏–≥—Ä–æ–≤—ã–µ –æ–±—ä–µ–∫—Ç—ã -->
    <script src="physics/FlipperShape.js"></script>
    <script src="physics/Ball.js"></script>
    <script src="physics/Wall.js"></script>
    <script src="physics/Flipper.js"></script>
    <script src="gameObjects/Bumper.js"></script>
    <script src="gameObjects/Spinner.js"></script>
    <script src="gameObjects/DropTarget.js"></script>
    <script src="gameObjects/Tunnel.js"></script>
    <script src="gameObjects/Ramp.js"></script>
    
    <!-- UI –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã -->
    <script src="ui/ScorePanel.js"></script>
    <script src="ui/GameOverOverlay.js"></script>
    <script src="ui/LevelSelectOverlay.js"></script>
    
    <!-- –ò–≥—Ä–æ–≤–æ–π –¥–≤–∏–∂–æ–∫ -->
    <script src="game/GameRenderer.js"></script>
    <script src="game/InputManager.js"></script>
    <script src="game/LevelManager.js"></script>
    <script src="game/LevelSelector.js"></script>
    <script src="game/PinballGame.js"></script>
    
    <!-- ‚úÖ –ü—Ä–æ—Å—Ç–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏–≥—Ä—ã -->
    <script>
        window.addEventListener('load', async () => {
            console.log('üéÆ Page loaded, initializing game...');
            
            // –°–æ–∑–¥–∞–µ–º –∏–≥—Ä—É –ë–ï–ó –æ–∂–∏–¥–∞–Ω–∏—è –∑–≤—É–∫–æ–≤
            const game = new PinballGame();
            
            // –ï—Å–ª–∏ –≤ Mini App, –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é
            if (window.isMiniApp && window.sdk) {
                game.setupSimpleFarcasterIntegration();
            }
        });

        // –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ–º –ø—Ä–æ–∫—Ä—É—Ç–∫—É –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö
        document.addEventListener('touchmove', (e) => {
            e.preventDefault();
        }, { passive: false });

        document.addEventListener('contextmenu', (e) => {
            e.preventDefault();
        });
    </script>
</body>
</html>